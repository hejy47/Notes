# 拜占庭将军问题

将军们必须有一个算法，使所有忠诚的将军们能够达成一致，而且少数几个叛徒不能使忠诚的将军们做出错误的计划。

## 算法保证

1. 所有忠诚的将军必须基于相同的行动计划做出决策
   1. 每一个忠诚的将军得到$v(1),\cdots,v(n)$相同的值。
   2. 对每一个i，如果第i个将军使忠诚的，其他忠诚的将军必须以他送出的值未$v(i)$。
   3. 重写条件1：对每一个i，不论第i个将军使忠诚的，或是叛徒，任何两个忠诚的将军使用相同的值$v(i)$。
2. 少数叛徒不能使忠诚的将军做出错误的计划。

## 拜占庭将军问题

一个司令要送一个命令给他的n-1个副官，使得

* IC1：所有忠诚的副官遵守同一个命令。
* IC2：假如司令是忠诚的，则每个忠诚的副官遵守他送出的该命令。

### 可解性

1. 叛徒数大于等于1/3，拜占庭问题不可解
2. 用口头信息，如果叛徒数少于1/3，拜占庭问题可解。
3. 用书写信息，如果至少有2/3的将军使忠诚的，拜占庭问题可解。

## 不可能结果

少于3m+1个将军（有m个叛徒）不存在解/不能达成共识

### 精确一致性证明

反证法：假设3m个将军(m个叛徒)存在解，用这一解来构造three-general (one traitor)问题的解。而3将军解由上文分析可以知道是不存在的（也就是如果构造出来了，那就说明3将军解存在），但这与已知(3将军问题不存在解)矛盾，所以假设(即3m将军问题存在解)不成立。

将3m将军m叛徒问题中的将军称为阿尔巴尼亚将军，3将军1叛徒中的将军称为拜占庭将军，以示区分。

对于阿尔巴尼亚将军，可知是满足IC1和IC2的，又由以上对应关系，可知3将军问题是满足IC1和IC2的，也即3将军问题存在解，与已知矛盾，故3m将军问题不存在解。

### 近似一致性证明

假设将军必须同意一个大致的攻击时间，而不是具体的攻击计划。

1. $IC1^\prime$：所有的忠诚的中尉在十分钟内发起攻击
2. $IC2^\prime$：若司令是忠诚的，则忠诚的中尉在司令命令中的进攻时间的+/-10min会进攻。

反证法：假设本问题有解，那么我们可以用这个节构造出拜占庭3将军问题的解。

## A Solution With Oral Messages

* 函数majority
* 算法OM(0)
* 算法OM(m)

### OM(m)算法的正确性证明

* 引理1：对任意m,k，若系统中将军总数超过2k+m，叛徒最多有k个，算法OM(m)满足IC2，即如果指挥官诚实，那么每一个诚实的中尉都遵从指挥官的命令。
* 定理1：对任意m，如果将军数量大于3m且叛徒数最多是m，算法OM(m)满足IC1和IC2。

## A Solution With Signed Messages

叛徒能够“撒谎”导致拜占庭将军问题变的难以解决。可以通过让将军发送不可伪造的信息的方式进行解决。

### SM(m)算法

大致流程：
* 指挥官发送带有自己签名的信息给所有中尉；
* 中尉在司令签名的基础上附上自己的签名并发给其他中尉；
* 其他中尉重复操作。

## Missing Communication Paths

### 对OM(m)的改进OM(m,p)

* 引理2：对任意m>0且p≥2k+m，在最多有k个叛徒的情况下，算法OM(m,p)仍然满足IC2。
* 定理3：对任何m>0,p>3m，在最多有m个叛徒的情况下，算法OM(m,p)能够解决拜占庭将军问题。
* 定理4：对任何m,d，在最多有m个叛徒并且诚实将军的子图直径(相聚最远的两点)d的情况下，算法SM(m+d-1)能够解决拜占庭将军问题。
* 推论：如果忠诚的将军的图是联通图，那么SM(n-2)能够解决n将军问题的拜占庭将军问题。

## Reliable Systems

### 可信系统的要素

* 一致性safety
* 可用性liveness

